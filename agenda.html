<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Agenda Semanal</title>
<link rel="icon" href="favicon.png" type="image/png" />
<link rel="stylesheet" href="style.css" />
<link rel="stylesheet" href="agenda.css" />
</head>
<body>
    <a id="topo"></a>
  
<a href="material.html" class="agenda-voltar">← Voltar para o início</a>

<!-- FORMULÁRIO -->
<h2>Adicionar Atividade</h2>
<form id="formAtividade">
  <div class="form-row">
    <label>Data: <input type="date" id="data" required></label>
    <label>Horário: <input type="time" id="horario" required></label>
    <label>Atividade:
      <select id="atividade" required>
        <option value="">Selecione</option>
        <option value="Livre">Livre</option>
        <option value="Scrim">Scrim</option>
        <option value="Torneio">Torneio</option>
        <option value="Reunião">Reunião</option>
        <option value="PatchNote">Patch Note</option>
        <option value="VodReview">Vod Review</option>
        <option value="Treino5stk">Treino 5 stk</option>
        <option value="TreinoDraft">Treino de Draft</option>
        <option value="AnalisedeCall">Analise de Call</option>
        <option value="TreinodeMicro">Treino de Micro</option>
        <option value="TreinodeMacro">Treino de Macro</option>
      </select>
    </label>
    <label>Responsável:
      <select id="responsavel" required>
        <option value="">Selecione</option>
        <option value="Lobo">Lobo</option>
        <option value="Shad">Shad</option>
        <option value="K1ng">K1ng</option>
        <option value="Leone">Leone</option>
      </select>
    </label>
    <label>Participantes:
      <select id="participantes" required>
        <option value="">Selecione</option>
        <option value="Staff">Staff</option>
        <option value="Time">Time</option>
        <option value="Todos">Todos</option>
      </select>
    </label>
    <label>Confirmar Dados:
      <button id="btnSalvar" type="submit">Adicionar</button>
    </label>
  </div>

  <!-- Campos extras para Scrim e Torneio -->
  <div id="extraInfo">
    <div class="extra-row">
      <label>Adversário:
        <input type="text" id="adversario" placeholder="Nome do time">
      </label>
      <label>Formato:
        <select id="formato">
          <option value="2x2">2x2</option>
          <option value="3x3">3x3</option>
        </select>
      </label>
      <label>Banimentos:
        <select id="banimentos">
          <option value="All Open">All Open</option>
        </select>
      </label>
      <label id="campeonatoLabel" style="display:none;">Campeonato:
        <input type="text" id="campeonato" placeholder="Nome do campeonato">
      </label>
    </div>
  </div>
</form>

<!-- TABELA -->
<table>
  <thead>
    <tr>
      <th>Segunda</th>
      <th>Terça</th>
      <th>Quarta</th>
      <th>Quinta</th>
      <th>Sexta</th>
      <th>Sábado</th>
      <th>Domingo</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td id="segunda"></td>
      <td id="terca"></td>
      <td id="quarta"></td>
      <td id="quinta"></td>
      <td id="sexta"></td>
      <td id="sabado"></td>
      <td id="domingo"></td>
    </tr>
  </tbody>
</table>

<!-- HISTÓRICO -->
<h2>Histórico de Atividades Concluídas</h2>
<ul id="historico"></ul>
<script src="agenda.js"></script>

<!-- Firebase SDK -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-app.js";
  import { getFirestore, collection, addDoc, onSnapshot, orderBy, query } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-firestore.js";

  // Configuração do Firebase
  const firebaseConfig = {
    apiKey: "AIzaSyC9LLCXrQTHBagQxaChBazSfS5E4gUPIoI",
    authDomain: "site-grn.firebaseapp.com",
    projectId: "site-grn",
    storageBucket: "site-grn.firebasestorage.app",
    messagingSenderId: "27613322806",
    appId: "1:27613322806:web:ad4dc08ce043f19d530297",
    measurementId: "G-84NHN394WF"
  };

  // Inicializa Firebase
  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  const btnSalvar = document.getElementById("btnSalvar");
  const listaNotas = document.getElementById("listaNotas");

  // Função para salvar no Firestore
  btnSalvar.addEventListener("click", async (e) => {
  e.preventDefault(); // evita refresh da página

  const data = document.getElementById("data").value;
  const horario = document.getElementById("horario").value;
  const atividade = document.getElementById("atividade").value;
  const responsavel = document.getElementById("responsavel").value;
  const participantes = document.getElementById("participantes").value;
  const adversario = document.getElementById("adversario").value;
  const formato = document.getElementById("formato").value;
  const banimentos = document.getElementById("banimentos").value;
  const campeonato = document.getElementById("campeonato").value;

  if (!data || !horario || !atividade || !responsavel || !participantes) {
    alert("Preencha todos os campos obrigatórios!");
    return;
  }

  try {
    await addDoc(collection(db, "agenda"), {
      data,
      horario,
      atividade,
      responsavel,
      participantes,
      adversario,
      formato,
      banimentos,
      campeonato,
      criadoEm: new Date()
    });
    
    // Limpar formulário
    document.getElementById("formAtividade").reset();
  } catch (e) {
    alert("Erro ao salvar: " + e.message);
  }
});

const diasSemana = ["domingo", "segunda", "terca", "quarta", "quinta", "sexta", "sabado"];

const tbodyCells = {
  "segunda": document.getElementById("segunda"),
  "terca": document.getElementById("terca"),
  "quarta": document.getElementById("quarta"),
  "quinta": document.getElementById("quinta"),
  "sexta": document.getElementById("sexta"),
  "sabado": document.getElementById("sabado"),
  "domingo": document.getElementById("domingo")
};

// Leitura em tempo real
const q = query(collection(db, "agenda"), orderBy("data"));
onSnapshot(q, (snapshot) => {
  // Limpar todas as células
  Object.values(tbodyCells).forEach(td => td.innerHTML = "");

  snapshot.forEach(doc => {
    const item = doc.data();
    const dia = new Date(item.data).getDay(); // 0=domingo, 1=segunda...
    const td = tbodyCells[diasSemana[dia]];

    const div = document.createElement("div");
    div.classList.add("agenda-item");
    div.innerHTML = `
      <strong>${item.horario} - ${item.atividade}</strong><br>
      Responsável: ${item.responsavel}<br>
      Participantes: ${item.participantes}<br>
      ${item.adversario ? "Adversário: " + item.adversario + "<br>" : ""}
      ${item.campeonato ? "Campeonato: " + item.campeonato + "<br>" : ""}
    `;
    td.appendChild(div);
  });
});

</script>

</body>
</html>