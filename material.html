<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="Ferramentas e materiais da Guariní e-sport: calculadoras e utilitários para jogadores." />
  <title>Materiais Guariní e-sport</title>
  <link rel="icon" href="favicon.png" type="image/png" />
  <link rel="stylesheet" href="style.css" />
  <link rel="stylesheet" href="materiais.css" />
</head>
<body>
  <a id="topo"></a>
  
  <header>
    <div class="header-wrapper">
      <!-- Navegação Desktop - Esquerda -->
      <nav class="nav-group left-nav">
        <ul>
          <li><a href="loja.html">Loja</a></li>
          <li><a href="sobre.html">Sobre</a></li>
        </ul>
      </nav>
      
      <!-- Logo Central -->
      <div class="logo-center">
        <a href="index.html" aria-label="Início">
          <img src="./logos/Guarini.png" alt="Guariní e-sport" class="header-logo">
        </a>
      </div>

      <!-- Navegação Desktop - Direita -->
      <nav class="nav-group right-nav">
        <ul>
          <li><a href="times.html">Times</a></li>
          <li><a href="material.html" class="ativo">Material</a></li>
        </ul>
      </nav>
      
      <!-- Botão Menu Mobile -->
      <button class="menu-toggle" aria-label="Menu">
        <span></span>
        <span></span>
        <span></span>
      </button>
      
      <!-- Menu Mobile -->
      <nav class="mobile-menu">
        <ul>
          <li><a href="index.html">Início</a></li>
          <li><a href="sobre.html">Sobre</a></li>
          <li><a href="times.html">Times</a></li>
          <li><a href="loja.html">Loja</a></li>
          <li><a href="material.html" class="ativo">Material</a></li>
          <li><a href="contato.html">Contato</a></li>
        </ul>
      </nav>
    </div>
  </header>

 <div class="user-container">
    <button class="btn-login-topo" id="loginLogoutBtn">Login</button>
    <div class="user-info" id="userInfo">
      Olá, <span id="userName"></span>!
    </div>
  </div>

  <main>
    <h2>Ferramentas</h2>
    <section class="ferramentas" style="background-color: rgba(0, 0, 0, 0.6); padding: 20px; border-radius: 10px; max-width: 900px; margin: auto;">
      <article class="ferramenta">
        <img src="./img-site/calculadora.png" alt="Calculadora de Performance">
        <h3>Calculadora de Performance</h3>
        <p class="descricao">Calcule suas estatísticas de jogo e compare com outros jogadores</p>
        <button type="button" class="btn-comprar" id="calcBtn">Acessar</button>
        <div id="accessMessage" style="color: red; margin-top: 10px; display: none;"></div>
      </article>

      <article class="ferramenta">
        <img src="./img-site/grafico.png" alt="Estatísticas" />
        <h3>Estatísticas do time</h3>
        <p class="descricao">Veja seu perfil com seus e os números da sua equipe</p>
        <button type="button" class="btn-comprar" id="statBtn">Acessar</button>
      </article>

      <article class="ferramenta">
        <img src="./img-site/embreve.png" alt="Em Breve" />
        <h3>Em Breve</h3>
        <p class="descricao">Nova ferramenta em desenvolvimento</p>
        <button type="button" class="btn-comprar" disabled>Indisponível</button>
      </article>
    </section>

    <p style="text-align:center; margin-top: 2rem;">
      <a href="index.html" class="btn-comprar">Voltar para Início</a>
    </p>
  </main>

  <footer>
    <p>&copy; 2025 Guariní e-sport. Todos os direitos reservados.</p>
    <p><a href="https://linktr.ee/guariniesports" target="_blank" rel="noopener noreferrer">Conheça nossas redes sociais</a></p>
    <p>Created by: Lobo</p>
  </footer>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { 
      getAuth, 
      onAuthStateChanged, 
      signOut 
    } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
    import { 
      getFirestore, 
      doc, 
      getDoc, 
      setDoc 
    } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyC9LLCXrQTHBagQxaChBazSfS5E4gUPIoI",
      authDomain: "site-grn.firebaseapp.com",
      projectId: "site-grn",
      storageBucket: "site-grn.firebasestorage.app",
      messagingSenderId: "27613322806",
      appId: "1:27613322806:web:ad4dc08ce043f19d530297",
      measurementId: "G-84NHN394WF"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    const loginLogoutBtn = document.getElementById("loginLogoutBtn");
    const userInfo = document.getElementById('userInfo');
    const userName = document.getElementById("userName");
    const calcBtn = document.getElementById("calcBtn");
    const statBtn = document.getElementById("statBtn");
    const accessMessage = document.getElementById("accessMessage");

    // Função para lidar com login
    async function handleLogin() {
      try {
        // Armazena a página atual para redirecionamento
        sessionStorage.setItem('redirectAfterLogin', 'material.html');
        // Redireciona para a página de login
        window.location.href = 'login.html';
      } catch (err) {
        console.error("Erro ao redirecionar para login:", err);
        alert('Erro ao tentar fazer login. Por favor, tente novamente.');
      }
    }

    // Função para lidar com logout
    async function handleLogout() {
      try {
        await signOut(auth);
      } catch (error) {
        console.error("Erro no logout:", error);
        alert('Erro ao fazer logout. Tente novamente.');
      }
    }

    // Atualiza a UI baseada no estado de autenticação
    function updateUI(user) {
      if (user) {
        loginLogoutBtn.textContent = 'Logout';
        loginLogoutBtn.onclick = handleLogout;
        
        const displayName = user.displayName || user.email.split('@')[0];
        userName.textContent = displayName;
        userInfo.style.display = 'block';
      } else {
        loginLogoutBtn.textContent = 'Login';
        loginLogoutBtn.onclick = handleLogin;
        userInfo.style.display = 'none';
      }
    }

    // Verifica permissões do usuário para a calculadora
    async function checkUserPermissions(user) {
      const docRef = doc(db, "usuarios", user.uid);
      const docSnap = await getDoc(docRef);

      if (docSnap.exists()) {
        const userData = docSnap.data();
        
        if (userData.role === 'player' || userData.role === 'admin') {
          calcBtn.onclick = () => window.location.href = 'desempenho.html';
          accessMessage.style.display = 'none';
        } else {
          setupRestrictedAccessUI();
        }
      } else {
        await setDoc(doc(db, "usuarios", user.uid), {
          email: user.email,
          role: 'user',
          createdAt: new Date()
        });
        setupRestrictedAccessUI();
      }
    }

    // Verifica permissões do usuário para estatísticas
    async function checkStatsPermissions(user) {
      const docRef = doc(db, "usuarios", user.uid);
      const docSnap = await getDoc(docRef);

      if (docSnap.exists()) {
        const userData = docSnap.data();
        
        // Permite acesso para jogadores e administradores
        if (userData.role === 'player' || userData.role === 'admin') {
          statBtn.onclick = () => window.location.href = './estatisticas-shad/indexStat.html';
        } else {
          setupRestrictedStatsAccessUI();
        }
      } else {
        setupRestrictedStatsAccessUI();
      }
    }

    function setupRestrictedAccessUI() {
      calcBtn.onclick = () => {
        accessMessage.textContent = "Você não tem permissão para usar essa ferramenta";
        accessMessage.style.display = 'block';
        setTimeout(() => {
          accessMessage.style.display = 'none';
        }, 3000);
      };
    }

    function setupRestrictedStatsAccessUI() {
      statBtn.onclick = () => {
        accessMessage.textContent = "Você não tem permissão para usar essa ferramenta";
        accessMessage.style.display = 'block';
        setTimeout(() => {
          accessMessage.style.display = 'none';
        }, 3000);
      };
    }

    // Monitora estado de autenticação
    onAuthStateChanged(auth, async (user) => {
      updateUI(user);
      
      if (user) {
        await checkUserPermissions(user);
        await checkStatsPermissions(user);
      } else {
        calcBtn.onclick = () => {
          accessMessage.textContent = "Faça login para acessar esta ferramenta";
          accessMessage.style.display = 'block';
          setTimeout(() => {
            accessMessage.style.display = 'none';
          }, 3000);
        };
        
        statBtn.onclick = () => {
          accessMessage.textContent = "Faça login para acessar esta ferramenta";
          accessMessage.style.display = 'block';
          setTimeout(() => {
            accessMessage.style.display = 'none';
          }, 3000);
        };
      }
    });

    // Funcionalidade do menu mobile
    const menuToggle = document.querySelector('.menu-toggle');
    const mobileMenu = document.querySelector('.mobile-menu');

    menuToggle.addEventListener('click', function() {
      this.classList.toggle('ativo');
      mobileMenu.classList.toggle('ativo');
    });

    // Fechar menu ao clicar em um link
    const mobileLinks = document.querySelectorAll('.mobile-menu a');
    mobileLinks.forEach(link => {
      link.addEventListener('click', function() {
        menuToggle.classList.remove('ativo');
        mobileMenu.classList.remove('ativo');
      });
    });

    // Fechar menu ao redimensionar para desktop
    window.addEventListener('resize', function() {
      if (window.innerWidth > 900) {
        menuToggle.classList.remove('ativo');
        mobileMenu.classList.remove('ativo');
      }
    });
  </script>
</body>
</html>