<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cadastrar Mentoria - E-Sports Academy</title>
    <link rel="stylesheet" href="./style-course.css">
</head>
<body>
    <div class="container">
        <h1>üéØ Cadastrar Mentoria</h1>
        <p class="subtitle">Ofere√ßa seu conhecimento atrav√©s de sess√µes individualizadas</p>

        <form id="courseForm">
            <!-- T√≠tulo da Mentoria -->
            <div class="form-group">
                <label for="title">T√≠tulo da Mentoria <span class="required">*</span></label>
                <input type="text" id="title" placeholder="Ex: Mentoria Intensiva de Valorant - An√°lise de Gameplay" required>
            </div>

            <!-- Upload de Imagem de Capa -->
            <div class="form-group">
                <label>Imagem de Capa <span class="required">*</span></label>
                <div class="file-input-wrapper">
                    <label for="coverImage" class="file-input-label">
                        üì∏ Escolher Imagem (JPG, PNG - m√°x 5MB)
                    </label>
                    <input type="file" id="coverImage" accept="image/jpeg,image/png,image/jpg" required>
                </div>
                <div class="file-name" id="coverImageName">Nenhum arquivo selecionado</div>
            </div>

            <!-- Descri√ß√£o Curta -->
            <div class="form-group">
                <label for="shortDesc">Descri√ß√£o Curta (para listagem) <span class="required">*</span></label>
                <textarea id="shortDesc" maxlength="200" placeholder="Resumo atrativo da sua mentoria (m√°ximo 200 caracteres)" required></textarea>
                <div class="char-counter"><span id="shortDescCount">0</span>/200</div>
            </div>

            <!-- Descri√ß√£o Completa -->
            <div class="form-group">
                <label for="longDesc">Descri√ß√£o Completa da Mentoria <span class="required">*</span></label>
                <textarea id="longDesc" rows="8" placeholder="Detalhe o que ser√° trabalhado nas sess√µes, metodologia, objetivos, pr√©-requisitos, etc." required></textarea>
            </div>

            <!-- Jogo / Modalidade -->
            <div class="form-group">
                <label for="gameMode">Jogo / Modalidade <span class="required">*</span></label>
                <select id="gameMode" required>
                    <option value="">Selecione o jogo</option>
                    <option value="League of Legends">League of Legends</option>
                    <option value="Valorant">Valorant</option>
                    <option value="CS:GO">CS:GO</option>
                    <option value="CS2">CS2</option>
                    <option value="Dota 2">Dota 2</option>
                    <option value="Fortnite">Fortnite</option>
                    <option value="Apex Legends">Apex Legends</option>
                    <option value="Rainbow Six Siege">Rainbow Six Siege</option>
                    <option value="Overwatch 2">Overwatch 2</option>
                    <option value="Call of Duty">Call of Duty</option>
                    <option value="Free Fire">Free Fire</option>
                    <option value="Outro">Outro</option>
                </select>
                <input type="text" id="otherGame" placeholder="Digite o nome do jogo" style="display: none; margin-top: 10px;">
            </div>

            <!-- Tipo de Mentoria -->
            <div class="form-group">
                <label>Tipo de Mentoria <span class="required">*</span></label>
                <div class="payment-methods">
                    <div class="payment-option">
                        <input type="radio" id="individual" name="mentoriaType" value="Individual" required>
                        <label for="individual">üë§ Individual</label>
                    </div>
                    <div class="payment-option">
                        <input type="radio" id="grupo" name="mentoriaType" value="Grupo" required>
                        <label for="grupo">üë• Grupo</label>
                    </div>
                </div>
            </div>

            <!-- Plataforma da Call -->
            <div class="form-group">
                <label>Plataforma da Call <span class="required">*</span></label>
                <div class="payment-methods">
                    <div class="payment-option">
                        <input type="radio" id="discord" name="platform" value="Discord" required>
                        <label for="discord">üí¨ Discord</label>
                    </div>
                    <div class="payment-option">
                        <input type="radio" id="zoom" name="platform" value="Zoom" required>
                        <label for="zoom">üìπ Zoom</label>
                    </div>
                    <div class="payment-option">
                        <input type="radio" id="meet" name="platform" value="Google Meet" required>
                        <label for="meet">üé• Google Meet</label>
                    </div>
                    <div class="payment-option">
                        <input type="radio" id="outra" name="platform" value="Outra" required>
                        <label for="outra">üåê Outra</label>
                    </div>
                </div>
                <input type="text" id="platformContact" placeholder="Ex: Link da sala Zoom, ID Discord, link Google Meet..." style="display: none; margin-top: 15px;">
                <div class="info-box" id="platformInfo" style="display: none; margin-top: 10px;">
                    üí° <strong>Dica:</strong> Informe como o aluno deve entrar em contato para agendar as sess√µes (Discord, WhatsApp, etc.)
                </div>
            </div>

            <!-- Dura√ß√£o de cada sess√£o -->
            <div class="form-group">
                <label for="sessionDuration">Dura√ß√£o de cada sess√£o (minutos) <span class="required">*</span></label>
                <select id="sessionDuration" required>
                    <option value="">Selecione a dura√ß√£o</option>
                    <option value="30">30 minutos</option>
                    <option value="60">60 minutos (1 hora)</option>
                    <option value="90">90 minutos (1h30)</option>
                    <option value="120">120 minutos (2 horas)</option>
                </select>
            </div>

            <!-- Quantidade de dias de mentoria -->
            <div class="form-group">
                <label for="mentoriaDays">Quantidade de sess√µes <span class="required">*</span></label>
                <select id="mentoriaDays" required>
                    <option value="">Selecione a quantidade</option>
                    <option value="1">1 sess√£o</option>
                    <option value="3">3 sess√µes</option>
                    <option value="5">5 sess√µes</option>
                    <option value="10">10 sess√µes (pacote semanal)</option>
                    <option value="20">20 sess√µes (pacote mensal)</option>
                </select>
            </div>

            <!-- Valor por sess√£o -->
            <div class="form-group">
                <label for="price">Valor por sess√£o (R$) <span class="required">*</span></label>
                <input type="number" id="price" min="0" step="0.01" placeholder="50.00" required>
                <div class="info-box" id="totalValue" style="display: none; margin-top: 10px;">
                    üí∞ <strong>Valor total da mentoria:</strong> R$ <span id="totalPrice">0,00</span>
                </div>
            </div>

            <!-- Disponibilidade do coach -->
            <div class="form-group">
                <label>Disponibilidade (dias da semana) <span class="required">*</span></label>
                <div class="payment-methods">
                    <div class="payment-option">
                        <input type="checkbox" id="seg" value="Segunda">
                        <label for="seg">Seg</label>
                    </div>
                    <div class="payment-option">
                        <input type="checkbox" id="ter" value="Ter√ßa">
                        <label for="ter">Ter</label>
                    </div>
                    <div class="payment-option">
                        <input type="checkbox" id="qua" value="Quarta">
                        <label for="qua">Qua</label>
                    </div>
                    <div class="payment-option">
                        <input type="checkbox" id="qui" value="Quinta">
                        <label for="qui">Qui</label>
                    </div>
                    <div class="payment-option">
                        <input type="checkbox" id="sex" value="Sexta">
                        <label for="sex">Sex</label>
                    </div>
                    <div class="payment-option">
                        <input type="checkbox" id="sab" value="S√°bado">
                        <label for="sab">S√°b</label>
                    </div>
                    <div class="payment-option">
                        <input type="checkbox" id="dom" value="Domingo">
                        <label for="dom">Dom</label>
                    </div>
                </div>
            </div>

            <!-- Hor√°rios dispon√≠veis -->
            <div class="form-group">
                <label for="availableHours">Hor√°rios dispon√≠veis <span class="required">*</span></label>
                <textarea id="availableHours" rows="3" placeholder="Ex: Segunda a Sexta: 14h √†s 18h / S√°bados: 10h √†s 12h" required></textarea>
            </div>

            <!-- Formas de Recebimento -->
            <div class="form-group">
                <label>Formas de Recebimento <span class="required">*</span></label>
                <div class="payment-methods">
                    <div class="payment-option">
                        <input type="checkbox" id="pix" value="Pix">
                        <label for="pix">üí∞ Pix</label>
                    </div>
                    <div class="payment-option">
                        <input type="checkbox" id="mercadopago" value="Mercado Pago">
                        <label for="mercadopago">üí≥ Mercado Pago</label>
                    </div>
                    <div class="payment-option">
                        <input type="checkbox" id="stripe" value="Stripe">
                        <label for="stripe">üíµ Stripe</label>
                    </div>
                    <div class="payment-option">
                        <input type="checkbox" id="paypal" value="PayPal">
                        <label for="paypal">üåê PayPal</label>
                    </div>
                </div>
            </div>

            <button type="submit" class="btn-submit" id="submitBtn">
                üöÄ Cadastrar Mentoria
            </button>
        </form>

        <div class="loading" id="loading">
            <div class="spinner"></div>
            <p>Cadastrando sua mentoria...</p>
        </div>

        <div class="message" id="message"></div>
    </div>

    <!-- Script JavaScript para c√°lculo autom√°tico e valida√ß√µes -->
    <script type="module">
        // Importar Firebase
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getFirestore, collection, addDoc, serverTimestamp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';
        import { getStorage, ref, uploadBytesResumable, getDownloadURL } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-storage.js';

        // ‚ö†Ô∏è CONFIGURA√á√ÉO DO FIREBASE - SUBSTITUA COM SUAS CREDENCIAIS
        const firebaseConfig = {
            apiKey: "SUA_API_KEY",
            authDomain: "SEU_AUTH_DOMAIN",
            projectId: "SEU_PROJECT_ID",
            storageBucket: "SEU_STORAGE_BUCKET",
            messagingSenderId: "SEU_MESSAGING_SENDER_ID",
            appId: "SEU_APP_ID"
        };

        // Inicializar Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const storage = getStorage(app);

        // Elementos do DOM
        const form = document.getElementById('courseForm');
        const submitBtn = document.getElementById('submitBtn');
        const loading = document.getElementById('loading');
        const message = document.getElementById('message');
        const shortDescInput = document.getElementById('shortDesc');
        const shortDescCount = document.getElementById('shortDescCount');
        const coverImageInput = document.getElementById('coverImage');
        const coverImageName = document.getElementById('coverImageName');
        const priceInput = document.getElementById('price');
        const mentoriaDaysInput = document.getElementById('mentoriaDays');
        const totalValueDiv = document.getElementById('totalValue');
        const totalPriceSpan = document.getElementById('totalPrice');
        const gameModeSelect = document.getElementById('gameMode');
        const otherGameInput = document.getElementById('otherGame');
        const platformContact = document.getElementById('platformContact');
        const platformInfo = document.getElementById('platformInfo');

        // Mostrar campo "Outro jogo" quando selecionado
        gameModeSelect.addEventListener('change', () => {
            if (gameModeSelect.value === 'Outro') {
                otherGameInput.style.display = 'block';
                otherGameInput.required = true;
            } else {
                otherGameInput.style.display = 'none';
                otherGameInput.required = false;
                otherGameInput.value = '';
            }
        });

        // Mostrar campo de contato quando selecionar qualquer plataforma
        document.querySelectorAll('input[name="platform"]').forEach(radio => {
            radio.addEventListener('change', () => {
                platformContact.style.display = 'block';
                platformInfo.style.display = 'block';
                platformContact.required = true;
                
                // Atualizar placeholder baseado na plataforma selecionada
                const platform = radio.value;
                if (platform === 'Discord') {
                    platformContact.placeholder = 'Ex: seu_usuario#1234 ou link do servidor Discord';
                } else if (platform === 'Zoom') {
                    platformContact.placeholder = 'Ex: Link da sala Zoom ou ID da reuni√£o';
                } else if (platform === 'Google Meet') {
                    platformContact.placeholder = 'Ex: Link do Google Meet';
                } else {
                    platformContact.placeholder = 'Ex: Link ou contato para realizar a mentoria';
                }
            });
        });

        // Contador de caracteres da descri√ß√£o curta
        shortDescInput.addEventListener('input', () => {
            shortDescCount.textContent = shortDescInput.value.length;
        });

        // Calcular valor total automaticamente
        function calculateTotal() {
            const pricePerSession = parseFloat(priceInput.value) || 0;
            const numberOfSessions = parseInt(mentoriaDaysInput.value) || 0;
            
            if (pricePerSession > 0 && numberOfSessions > 0) {
                const total = pricePerSession * numberOfSessions;
                totalPriceSpan.textContent = total.toFixed(2).replace('.', ',');
                totalValueDiv.style.display = 'block';
            } else {
                totalValueDiv.style.display = 'none';
            }
        }

        priceInput.addEventListener('input', calculateTotal);
        mentoriaDaysInput.addEventListener('change', calculateTotal);

        // Exibir nome do arquivo de imagem selecionado
        coverImageInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                coverImageName.textContent = file.name;
                if (file.size > 5 * 1024 * 1024) {
                    showMessage('A imagem deve ter no m√°ximo 5MB', 'error');
                    coverImageInput.value = '';
                    coverImageName.textContent = 'Nenhum arquivo selecionado';
                }
            }
        });

        // Fun√ß√£o para exibir mensagens
        function showMessage(text, type) {
            message.textContent = text;
            message.className = `message ${type}`;
            message.style.display = 'block';
            setTimeout(() => {
                message.style.display = 'none';
            }, 5000);
        }

        // Fun√ß√£o para fazer upload de arquivo
        async function uploadFile(file, path) {
            return new Promise((resolve, reject) => {
                const storageRef = ref(storage, path);
                const uploadTask = uploadBytesResumable(storageRef, file);

                uploadTask.on('state_changed',
                    (snapshot) => {
                        const progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
                        console.log('Upload: ' + progress + '%');
                    },
                    (error) => {
                        reject(error);
                    },
                    async () => {
                        const downloadURL = await getDownloadURL(uploadTask.snapshot.ref);
                        resolve(downloadURL);
                    }
                );
            });
        }

        // Submiss√£o do formul√°rio
        form.addEventListener('submit', async (e) => {
            e.preventDefault();

            // Coletar dados do formul√°rio
            const title = document.getElementById('title').value.trim();
            const shortDesc = document.getElementById('shortDesc').value.trim();
            const longDesc = document.getElementById('longDesc').value.trim();
            let gameMode = document.getElementById('gameMode').value;
            const otherGame = document.getElementById('otherGame').value.trim();
            const sessionDuration = document.getElementById('sessionDuration').value;
            const mentoriaDays = document.getElementById('mentoriaDays').value;
            const availableHours = document.getElementById('availableHours').value.trim();
            const price = parseFloat(document.getElementById('price').value);
            const coverImage = coverImageInput.files[0];
            const platformContactValue = document.getElementById('platformContact').value.trim();

            // Se selecionou "Outro" jogo, usar o valor digitado
            if (gameMode === 'Outro' && otherGame) {
                gameMode = otherGame;
            }

            // Tipo de mentoria (radio)
            const mentoriaType = document.querySelector('input[name="mentoriaType"]:checked')?.value;

            // Plataforma (radio)
            const platform = document.querySelector('input[name="platform"]:checked')?.value;

            // Disponibilidade (checkboxes)
            const availability = [];
            document.querySelectorAll('#seg, #ter, #qua, #qui, #sex, #sab, #dom').forEach(checkbox => {
                if (checkbox.checked) availability.push(checkbox.value);
            });

            // Formas de pagamento (checkboxes)
            const paymentMethods = [];
            document.querySelectorAll('#pix, #mercadopago, #stripe, #paypal').forEach(checkbox => {
                if (checkbox.checked) paymentMethods.push(checkbox.value);
            });

            // Valida√ß√µes
            if (!title || !shortDesc || !longDesc || !gameMode || !sessionDuration || !mentoriaDays || !availableHours || !price || !coverImage) {
                showMessage('Por favor, preencha todos os campos obrigat√≥rios', 'error');
                return;
            }

            if (!mentoriaType) {
                showMessage('Selecione o tipo de mentoria (Individual ou Grupo)', 'error');
                return;
            }

            if (!platform) {
                showMessage('Selecione a plataforma da call', 'error');
                return;
            }

            if (!platformContactValue) {
                showMessage('Informe o link ou contato da plataforma escolhida', 'error');
                return;
            }

            if (availability.length === 0) {
                showMessage('Selecione pelo menos um dia de disponibilidade', 'error');
                return;
            }

            if (paymentMethods.length === 0) {
                showMessage('Selecione pelo menos uma forma de recebimento', 'error');
                return;
            }

            if (price <= 0) {
                showMessage('O valor por sess√£o deve ser maior que zero', 'error');
                return;
            }

            // Calcular valor total
            const totalValue = price * parseInt(mentoriaDays);

            // Desabilitar bot√£o e mostrar loading
            submitBtn.disabled = true;
            loading.style.display = 'block';
            message.style.display = 'none';

            try {
                // Upload da imagem de capa
                const timestamp = Date.now();
                const coverImagePath = `mentorias/covers/${timestamp}_${coverImage.name}`;
                const coverImageUrl = await uploadFile(coverImage, coverImagePath);

                // Salvar dados no Firestore
                const mentoriaData = {
                    title: title,
                    shortDescription: shortDesc,
                    longDescription: longDesc,
                    gameMode: gameMode,
                    mentoriaType: mentoriaType,
                    platform: platform,
                    platformContact: platformContactValue,
                    sessionDuration: parseInt(sessionDuration),
                    numberOfSessions: parseInt(mentoriaDays),
                    pricePerSession: price,
                    totalValue: totalValue,
                    availability: availability,
                    availableHours: availableHours,
                    coverImageUrl: coverImageUrl,
                    paymentMethods: paymentMethods,
                    createdAt: serverTimestamp(),
                };

                const docRef = await addDoc(collection(db, 'mentorias'), mentoriaData);

                // Sucesso
                showMessage(`‚úÖ Mentoria cadastrada com sucesso! ID: ${docRef.id}`, 'success');
                form.reset();
                coverImageName.textContent = 'Nenhum arquivo selecionado';
                shortDescCount.textContent = '0';
                totalValueDiv.style.display = 'none';
                otherGameInput.style.display = 'none';
                platformContact.style.display = 'none';
                platformInfo.style.display = 'none';

            } catch (error) {
                console.error('Erro ao cadastrar mentoria:', error);
                showMessage(`‚ùå Erro ao cadastrar mentoria: ${error.message}`, 'error');
            } finally {
                submitBtn.disabled = false;
                loading.style.display = 'none';
            }
        });
    </script>
</body>
</html>