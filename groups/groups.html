<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="Ferramentas e materiais da Guarin√≠ e-sport: calculadoras e utilit√°rios para jogadores." />
  <title>Materiais Guarin√≠ e-sport</title>
  <link rel="icon" href="../img-site/favicon.png" type="image/png" />
  <link rel="stylesheet" href="../style.css" />
  <link rel="stylesheet" href="groups.css" />
  <style>
    .ferramentas {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 20px;
      background-color: rgba(0, 0, 0, 0.6);
      padding: 20px;
      border-radius: 10px;
      max-width: 900px;
      margin: auto;
    }

    .ferramenta {
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      height: 100%;
    }

    .ferramenta .descricao {
      flex-grow: 1;
      display: flex;
      align-items: center;
    }

    @media (max-width: 768px) {
      .ferramentas {
        grid-template-columns: 1fr;
      }
    }

    @media (min-width: 769px) and (max-width: 1024px) {
      .ferramentas {
        grid-template-columns: repeat(2, 1fr);
      }
    }
  </style>

<script type="text/javascript">
function googleTranslateElementInit() {
  new google.translate.TranslateElement(
    {pageLanguage: 'pt', includedLanguages: 'pt,en,ja'},
    'google_translate_element'
  );
}
</script>

<script type="text/javascript" src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>
<!-- Adsense tag -->
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4262085354518962"
     crossorigin="anonymous"></script>
</head>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-84NHN394WF"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-84NHN394WF');
</script>
<body>
  <a id="topo"></a>
  
  <header>
    <div class="header-wrapper">
      <!-- Navega√ß√£o Desktop - Esquerda -->
      <nav class="nav-group left-nav">
        <ul>
          <li><a href="../loja/loja.html">Shop</a></li>
          <li><a href="../sobre/sobre.html">About</a></li>
        </ul>
      </nav>
      
      <!-- Logo Central -->
      <div class="logo-center">
        <a href="../index.html" aria-label="In√≠cio">
          <img src="../img-site/Guarini.png" alt="Guarin√≠ e-sport" class="header-logo">
        </a>
      </div>

      <!-- Navega√ß√£o Desktop - Direita -->
      <nav class="nav-group right-nav">
        <ul>
          <li><a href="groups.html" class="ativo">Games</a></li>
          <li><a href="../contato/contato.html">Contact</a></li>
        </ul>
      </nav>
      
      <!-- Bot√£o Menu Mobile -->
      <button class="menu-toggle" aria-label="Menu">
        <span></span>
        <span></span>
        <span></span>
      </button>
      
      <!-- Menu Mobile -->
      <nav class="mobile-menu">
        <ul>
          <li><a href="index.html">In√≠cio</a></li>
          <li><a href="sobre.html">Sobre</a></li>
          <li><a href="equipes.html">Times</a></li>
          <li><a href="loja.html">Loja</a></li>
          <li><a href="material.html" class="ativo">Material</a></li>
          <li><a href="contato.html">Contato</a></li>
        </ul>
      </nav>
    </div>
  </header>

    <div class="user-menu-container">
    <button class="user-menu-toggle" id="userMenuToggle" aria-label="Menu do usu√°rio">
      <span></span>
      <span></span>
      <span></span>
    </button>
    
    <div class="user-dropdown" id="userDropdown">
      <div class="user-dropdown-header" id="userDropdownHeader">
        <span>Hello, visitor!</span>
      </div>
      <ul class="user-dropdown-list">
        <li><a href="../perfil/perfil.html" id="perfilLink">Profile</a></li>
        <li><a href="#" id="authLink">Login</a></li>
      </ul>
    </div>
  </div>

  <!-- Barra de busca de perfis -->
  <div class="profile-search-container">
    <div class="profile-search-wrapper">
      <input 
        type="text" 
        id="profileSearchInput" 
        class="profile-search-input" 
        placeholder="Search Player ID..."
        maxlength="7"
      >
      <button class="profile-search-btn" id="profileSearchBtn" title="Search Profile">
        üîç
      </button>
    </div>
    <div class="profile-search-results" id="profileSearchResults"></div>
  </div>

  <main>
    <h2>Communitys</h2>
    <section class="ferramentas">
      <!-- Pok√©mon Unite
      <article class="ferramenta">
        <img src="../img-site/pokemonunite.png" alt="Pok√©mon Unite" />
        <h3>Pok√©mon Unite</h3>
        <p class="descricao">Veja as ferramentas para Pok√©mon Unite</p>
        <button type="button" class="btn-comprar" id="statBtn">Acessar</button>
        <div id="statAccessMessage" style="color: red; margin-top: 10px; display: none;"></div>
      </article>-->

      <!-- Slot vazio para futura Comunidade -->
      <article class="ferramenta">
        <img src="../img-site/pokemonunite.png" alt="Build Maker" />
        <h3>Pok√©mon Unite</h3>
        <p class="descricao">See Tools for Pok√©mon Unite</p>
        <button type="button" class="btn-comprar" id="buildBtn">Open</button>
        <div id="buildAccessMessage" style="color: red; margin-top: 10px; display: none;"></div>
      </article>

      <!-- Slot vazio para futura Comunidade -->
      <article class="ferramenta" style="opacity: 0.3;">
        <img src="../img-site/embreve.png" alt="Em Breve" />
        <h3>Coming Soon</h3>
        <p class="descricao">New Community will be added here</p>
        <button type="button" class="btn-comprar" disabled>Coming Soon</button>
      </article>      

      <!-- Slot vazio para futura Comunidade -->
      <article class="ferramenta" style="opacity: 0.3;">
        <img src="../img-site/embreve.png" alt="Em Breve" />
        <h3>Coming Soon</h3>
        <p class="descricao">New Community will be added here</p>
        <button type="button" class="btn-comprar" disabled>Coming Soon</button>
      </article>

    </section>

    <p style="text-align:center; margin-top: 2rem;">
      <a href="../index.html" class="btn-comprar">Back to Home</a>
    </p>
  </main>

<footer>
  <div class="footer-content">
    <!-- Bot√µes de a√ß√£o no footer -->
    <div class="footer-actions">
      <!-- Bot√£o de instalar app -->
      <button id="installBtn" class="btn-install">üì± Install App</button>
      
      <!-- Seletor de idioma customizado -->
      <div class="language-selector">
        <button class="language-btn" id="languageBtn">
          <span class="flag flag-us"></span>
          <span id="currentLang">English</span>
          <span>‚ñº</span>
        </button>
        <div class="language-dropdown" id="languageDropdown">
          <div class="language-option" data-lang="pt" data-flag="flag-br" data-name="Portugu√™s">
            <span class="flag flag-br"></span>
            <span>Portugu√™s</span>
          </div>
          <div class="language-option" data-lang="en" data-flag="flag-us" data-name="English">
            <span class="flag flag-us"></span>
            <span>English</span>
          </div>
          <div class="language-option" data-lang="ja" data-flag="flag-jp" data-name="Êó•Êú¨Ë™û">
            <span class="flag flag-jp"></span>
            <span>Êó•Êú¨Ë™û</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Informa√ß√µes do footer -->
    <div class="footer-info">
      <p>&copy; ¬© 2019 Guarin√≠ E-sport. All rights reserved.</p>
      <p><a href="https://linktr.ee/guariniesports" target="_blank">Follow us on social media!</a></p>
      <p>Created by: Lobo & Shad</p>
    </div>
  </div>
</footer>


  <script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-app.js";
  import { 
    getAuth, 
    onAuthStateChanged, 
    signOut 
  } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-auth.js";
  import { 
    getFirestore, 
    doc, 
    getDoc,
    setDoc,
    collection, 
    query, 
    where, 
    getDocs 
  } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyC9LLCXrQTHBagQxaChBazSfS5E4gUPIoI",
    authDomain: "site-grn.firebaseapp.com",
    projectId: "site-grn",
    storageBucket: "site-grn.firebasestorage.app",
    messagingSenderId: "27613322806",
    appId: "1:27613322806:web:ad4dc08ce043f19d530297",
    measurementId: "G-84NHN394WF"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);

  // ========================================
  // ELEMENTOS DO DOM - MENU USU√ÅRIO
  // ========================================
  const userMenuToggle = document.getElementById('userMenuToggle');
  const userDropdown = document.getElementById('userDropdown');
  const userDropdownHeader = document.getElementById('userDropdownHeader');
  const authLink = document.getElementById('authLink');
  const perfilLink = document.getElementById('perfilLink');

  // ========================================
  // ELEMENTOS DO DOM - BUSCA DE PERFIL
  // ========================================
  const profileSearchBtn = document.getElementById('profileSearchBtn');
  const profileSearchInput = document.getElementById('profileSearchInput');
  const profileSearchResults = document.getElementById('profileSearchResults');

  // ========================================
  // ELEMENTOS DO DOM - FERRAMENTAS
  // ========================================
  const calcBtn = document.getElementById("calcBtn");
  const statBtn = document.getElementById("statBtn");
  const winrateBtn = document.getElementById("winrateBtn");
  const analiseBtn = document.getElementById("analiseBtn");
  const buildBtn = document.getElementById("buildBtn");
  const quizBtn = document.getElementById("quizBtn");
  const calcAccessMessage = document.getElementById("calcAccessMessage");
  const statAccessMessage = document.getElementById("statAccessMessage");
  const calcWinrateMessage = document.getElementById("calcWinrateMessage");
  const analiseAccessMessage = document.getElementById("analiseAccessMessage");
  const buildAccessMessage = document.getElementById("buildAccessMessage");
  const quizAccessMessage = document.getElementById("quizAccessMessage");

  // ========================================
  // MENU DROPDOWN DO USU√ÅRIO
  // ========================================
  
  // Toggle do menu dropdown
  userMenuToggle.addEventListener('click', function(e) {
    e.stopPropagation();
    this.classList.toggle('active');
    userDropdown.classList.toggle('show');
  });

  // Fechar dropdown ao clicar fora
  document.addEventListener('click', function(e) {
    if (!userMenuToggle.contains(e.target) && !userDropdown.contains(e.target)) {
      userMenuToggle.classList.remove('active');
      userDropdown.classList.remove('show');
    }
  });

  // Fechar dropdown ao clicar em um link
  userDropdown.querySelectorAll('a').forEach(link => {
    link.addEventListener('click', function() {
      userMenuToggle.classList.remove('active');
      userDropdown.classList.remove('show');
    });
  });

  // ========================================
  // BUSCA DE PERFIL - COM BUSCA AUTOM√ÅTICA
  // ========================================

  // Fun√ß√£o para buscar perfil
  async function buscarPerfil() {
    const playerId = profileSearchInput.value.trim().toUpperCase();
    
    if (!playerId) {
      profileSearchResults.classList.remove('show');
      return;
    }
    
    if (playerId.length !== 7) {
      profileSearchResults.classList.remove('show');
      return;
    }
    
    try {
      profileSearchResults.innerHTML = '<div class="profile-search-no-results">üîç Searching...</div>';
      profileSearchResults.classList.add('show');
      
      const usuariosRef = collection(db, "usuarios");
      const q = query(usuariosRef, where("playerId", "==", playerId));
      const querySnapshot = await getDocs(q);
      
      if (querySnapshot.empty) {
        profileSearchResults.innerHTML = '<div class="profile-search-no-results">‚ùå Player not found</div>';
        return;
      }
      
      const userDoc = querySnapshot.docs[0];
      const userData = userDoc.data();
      const userId = userDoc.id;
      
      profileSearchResults.innerHTML = `
        <div class="profile-search-result-item" style="background: rgba(255, 173, 0, 0.1); cursor: default;">
          <div style="flex: 1;">
            <div style="color: #ffad00; font-weight: bold; margin-bottom: 5px;">
              ‚úÖ Player found!
            </div>
            <div style="color: #fff; font-size: 13px;">
              ${userData.displayName || 'Anonymous'}
            </div>
            <div style="color: #aaa; font-size: 11px; margin-top: 3px;">
              ID: ${userData.playerId}
            </div>
          </div>
        </div>
        <div style="margin-top: 10px; text-align: center;">
          <button 
            onclick="window.location.href='./perfil/perfil-view.html?uid=${userId}'" 
            style="background: linear-gradient(45deg, #ff7500, #ffad00); border: none; padding: 10px 20px; border-radius: 8px; color: #000; font-weight: bold; cursor: pointer; transition: all 0.3s ease;"
            onmouseover="this.style.transform='scale(1.05)'; this.style.boxShadow='0 5px 15px rgba(255, 173, 0, 0.5)'"
            onmouseout="this.style.transform='scale(1)'; this.style.boxShadow='none'"
          >
            üë§ View Profile
          </button>
        </div>
      `;
      
    } catch (error) {
      console.error('‚ùå Erro ao buscar perfil:', error);
      profileSearchResults.innerHTML = `
        <div class="profile-search-no-results" style="color: #ff6b6b;">
          ‚ùå Search error<br>
          <small style="font-size: 11px; color: #aaa; margin-top: 5px; display: block;">
            ${error.message}
          </small>
        </div>
      `;
    }
  }

  // Toggle da barra de busca
  profileSearchBtn.addEventListener('click', (e) => {
    e.stopPropagation();
    profileSearchInput.classList.toggle('active');
    
    if (profileSearchInput.classList.contains('active')) {
      profileSearchInput.focus();
    } else {
      profileSearchInput.value = '';
      profileSearchResults.classList.remove('show');
    }
  });

  // Buscar ao pressionar Enter
  profileSearchInput.addEventListener('keypress', async (e) => {
    if (e.key === 'Enter') {
      await buscarPerfil();
    }
  });

  // Valida√ß√£o do input e BUSCA AUTOM√ÅTICA ao digitar 7 caracteres
  profileSearchInput.addEventListener('input', async (e) => {
    e.target.value = e.target.value.toUpperCase().replace(/[^A-Z0-9]/g, '');
    if (e.target.value.length > 7) {
      e.target.value = e.target.value.slice(0, 7);
    }
    
    if (e.target.value.length === 7) {
      await buscarPerfil();
    } else {
      profileSearchResults.classList.remove('show');
    }
  });

  // Fechar ao clicar fora
  document.addEventListener('click', (e) => {
    if (!e.target.closest('.profile-search-container')) {
      profileSearchInput.classList.remove('active');
      profileSearchResults.classList.remove('show');
    }
  });

  // ========================================
  // AUTENTICA√á√ÉO DO USU√ÅRIO
  // ========================================
  
  // Fun√ß√£o para atualizar a interface com base no estado do usu√°rio
  async function updateUI(user) {
    if (user) {
      try {
        const userDocRef = doc(db, "usuarios", user.uid);
        const userDocSnap = await getDoc(userDocRef);
        
        let displayName = user.displayName || user.email.split('@')[0];
        let avatarPath = './estatisticas-shad/images/backgrounds/pikachu-left-bg.png';
        
        if (userDocSnap.exists()) {
          const userData = userDocSnap.data();
          if (userData.displayName) {
            displayName = userData.displayName;
          }
          if (userData.avatar) {
            avatarPath = userData.avatar;
          }
        }
        
        userDropdownHeader.innerHTML = `
          <img src="${avatarPath}" alt="Avatar" class="dropdown-avatar">
          <span>Ol√°, ${displayName}!</span>
        `;
        authLink.textContent = 'Logout';
        authLink.onclick = function(e) {
          e.preventDefault();
          handleLogout();
        };
        perfilLink.style.display = 'block';
        
      } catch (error) {
        console.error('‚ùå Erro ao carregar dados do usu√°rio:', error);
        userDropdownHeader.innerHTML = `
          <img src="./estatisticas-shad/images/backgrounds/pikachu-left-bg.png" alt="Avatar" class="dropdown-avatar">
          <span>Ol√°, ${user.email.split('@')[0]}!</span>
        `;
        authLink.textContent = 'Logout';
        authLink.onclick = function(e) {
          e.preventDefault();
          handleLogout();
        };
        perfilLink.style.display = 'block';
      }
    } else {
      userDropdownHeader.innerHTML = '<span>Ol√°, visitante!</span>';
      authLink.textContent = 'Login';
      authLink.onclick = function(e) {
        e.preventDefault();
        handleLogin();
      };
      perfilLink.style.display = 'none';
    }
  }

  // Fun√ß√£o para fazer login
  function handleLogin() {
    sessionStorage.setItem('redirectAfterLogin', 'material.html');
    window.location.href = './login/login.html';
  }

  // Fun√ß√£o para fazer logout
  async function handleLogout() {
    const confirmar = confirm('Deseja realmente fazer logout?');
    if (confirmar) {
      try {
        localStorage.removeItem('userDisplayName');
        localStorage.removeItem('userAvatar');
        await signOut(auth);
        alert('Logout realizado com sucesso!');
      } catch (error) {
        console.error('Erro no logout:', error);
        alert('Erro ao fazer logout. Tente novamente.');
      }
    }
  }

  // ========================================
  // FERRAMENTAS - CONFIGURA√á√ÉO DE ACESSO
  // ========================================

  function setupBuildAccess() {
    buildBtn.onclick = () => window.location.href = '../material.html';
    buildAccessMessage.style.display = 'none';
  }

  function setupQuizAccess() {
    quizBtn.onclick = () => window.location.href = 'quiz.html';
    quizAccessMessage.style.display = 'none';
  }

  async function checkStatsPermissions(user) {
    if (!user) {
      setupRestrictedStatsAccess("Fa√ßa login para acessar esta ferramenta");
      return;
    }

    try {
      const docRef = doc(db, "usuarios", user.uid);
      const docSnap = await getDoc(docRef);

      if (docSnap.exists()) {
        const userData = docSnap.data();
        
        if (userData.role === 'player' || userData.role === 'admin') {
          statBtn.onclick = () => window.location.href = './estatisticas-shad/indexStat.html';
          statAccessMessage.style.display = 'none';
        } else {
          setupRestrictedStatsAccess("Voc√™ n√£o tem permiss√£o para usar essa ferramenta");
        }
      } else {
        await setDoc(doc(db, "usuarios", user.uid), {
          email: user.email,
          role: 'user',
          createdAt: new Date()
        });
        setupRestrictedStatsAccess("Voc√™ n√£o tem permiss√£o para usar essa ferramenta");
      }
    } catch (error) {
      console.error("Erro ao verificar permiss√µes:", error);
      setupRestrictedStatsAccess("Erro ao verificar permiss√µes. Tente novamente.");
    }
  }

  function setupRestrictedStatsAccess(message) {
    statBtn.onclick = () => {
      statAccessMessage.textContent = message;
      statAccessMessage.style.display = 'block';
      setTimeout(() => {
        statAccessMessage.style.display = 'none';
      }, 3000);
    };
  }

  // ========================================
  // MONITORA AUTENTICA√á√ÉO
  // ========================================
  onAuthStateChanged(auth, async (user) => {
    await updateUI(user);
    setupBuildAccess();
    setupQuizAccess();
    
    await checkStatsPermissions(user);
  });

  // ========================================
  // MENU MOBILE
  // ========================================
  const menuToggle = document.querySelector('.menu-toggle');
  const mobileMenu = document.querySelector('.mobile-menu');

  menuToggle.addEventListener('click', function() {
    this.classList.toggle('ativo');
    mobileMenu.classList.toggle('ativo');
  });

  const mobileLinks = document.querySelectorAll('.mobile-menu a');
  mobileLinks.forEach(link => {
    link.addEventListener('click', function() {
      menuToggle.classList.remove('ativo');
      mobileMenu.classList.remove('ativo');
    });
  });

  window.addEventListener('resize', function() {
    if (window.innerWidth > 900) {
      menuToggle.classList.remove('ativo');
      mobileMenu.classList.remove('ativo');
    }
  });
</script>
</body>
</html>