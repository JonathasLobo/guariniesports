<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="Confira os produtos oficiais da Guarin√≠ e-sport na nossa loja: camisas, bon√©s, mousepads e muito mais." />
  <title>Loja Guarin√≠ e-sport</title>
  <link rel="icon" href="../img-site/favicon.png" type="image/png" />
  <link rel="stylesheet" href="../style.css" />
<!-- Google Translate (oculto) -->
<div id="google_translate_element" style="display: none;"></div>

<script type="text/javascript">
function googleTranslateElementInit() {
  new google.translate.TranslateElement(
    {pageLanguage: 'pt', includedLanguages: 'pt,en,ja'},
    'google_translate_element'
  );
}
</script>

<script type="text/javascript" src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>
<!-- Adsense tag -->
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4262085354518962"
     crossorigin="anonymous"></script>
</head>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-84NHN394WF"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-84NHN394WF');
</script>
<body>
  <a id="topo"></a>
  
  <header>
    <div class="header-wrapper">
      <!-- Navega√ß√£o Desktop - Esquerda -->
      <nav class="nav-group left-nav">
        <ul>
          <li><a href="./loja.html">Shop</a></li>
          <li><a href="../sobre/sobre.html">About</a></li>
        </ul>
      </nav>
      
      <!-- Logo Central -->
      <div class="logo-center">
        <a href="../index.html" aria-label="In√≠cio" class="ativo">
          <img src="../img-site/grn-logo.png" alt="Guarini e-sport" class="header-logo">
        </a>
      </div>

      <!-- Navega√ß√£o Desktop - Direita -->
      <nav class="nav-group right-nav">
        <ul>
          <li><a href="../groups/groups.html">Games</a></li>
          <li><a href="../contato/contato.html">Contact</a></li>
        </ul>
      </nav>
    </div>
  </header>

  <!-- Menu dropdown do usu√°rio -->
  <div class="user-menu-container">
    <button class="user-menu-toggle" id="userMenuToggle" aria-label="Menu do usu√°rio">
      <span></span>
      <span></span>
      <span></span>
    </button>
    
    <div class="user-dropdown" id="userDropdown">
      <div class="user-dropdown-header" id="userDropdownHeader">
        <span>Hello, visitor!</span>
      </div>
      <ul class="user-dropdown-list">
        <li><a href="../perfil/perfil.html" id="perfilLink">Profile</a></li>
        <li><a href="./loja.html">Shop</a></li>
        <li><a href="../sobre/sobre.html">About</a></li>
        <li><a href="../groups/groups.html">Games</a></li>
        <li><a href="../contato/contato.html">Contact</a></li>
        <li><a href="#" id="authLink">Login</a></li>
      </ul>
    </div>
  </div>

  <!-- Barra de busca de perfis -->
  <div class="profile-search-container">
    <div class="profile-search-wrapper">
      <input 
        type="text" 
        id="profileSearchInput" 
        class="profile-search-input" 
        placeholder="Search Player ID..."
        maxlength="7"
      >
      <button class="profile-search-btn" id="profileSearchBtn" title="Search Profile">
        üîç
      </button>
    </div>
    <div class="profile-search-results" id="profileSearchResults"></div>
  </div>

  <main>
    <h2>Official Shop Guarin√≠</h2>
    <section class="produtos">
      <article class="produto">
        <img src="./img-shop/camisa.jpg" alt="Camisa Oficial Guarin√≠" />
        <h3>Official Shirt</h3>
        <p class="preco">Coming soon</p>
        <button type="button" class="btn-comprar" disabled>Coming soon</button>
      </article>

      <article class="produto">
        <img src="./img-shop/fone.jpg" alt="Fone de Ouvido Bluetooth" />
        <h3>Fone de Ouvido Bluetooth</h3>
        <p class="preco">R$ 68,58</p>
        <button type="button" class="btn-comprar" data-link="https://amzn.to/3L4yIt3">Buy</button>
      </article>

      <article class="produto">
        <img src="./img-shop/mochila.jpg" alt="Mochila Guarin√≠" />
        <h3>Backpack</h3>
        <p class="preco">$ 47,70</p>
        <button type="button" class="btn-comprar" data-link="https://streamlabs.com/guarini_esports/merch/5571573">Buy</button>
      </article>

      <article class="produto">
        <img src="./img-shop/agenda.jpg" alt="Caderno capa dura Guarin√≠" />
        <h3>Hardcover Notebook</h3>
        <p class="preco">$ 21,00</p>
        <button type="button" class="btn-comprar" data-link="https://streamlabs.com/guarini_esports/merch/5023076">Buy</button>
      </article>

      <article class="produto">
        <img src="./img-shop/caderno.jpg" alt="Caderno espiral Guarin√≠" />
        <h3> Spiral Notebook</h3>
        <p class="preco">$ 20,00</p>
        <button type="button" class="btn-comprar" data-link="https://streamlabs.com/guarini_esports/merch/5609860">Buy</button>
      </article>

      <article class="produto">
        <img src="./img-shop/garrafinha.jpg" alt="Garrafa de √°gua Guarin√≠" />
        <h3>Stainless Steel Water Bottle</h3>
        <p class="preco">$ 30,00</p>
        <button type="button" class="btn-comprar" data-link="https://streamlabs.com/guarini_esports/merch/5023084">Buy</button>
      </article>    

      <article class="produto">
        <img src="./img-shop/caneca.jpg" alt="Caneca Guarin√≠" />
        <h3>Travel Mug with Handle</h3>
        <p class="preco">$ 29,00</p>
        <button type="button" class="btn-comprar" data-link="https://streamlabs.com/guarini_esports/merch/5023087">Buy</button>
      </article>  

      <article class="produto">
        <img src="./img-shop/copo-canudo.jpg" alt="Copo de a√ßo Guarin√≠" />
        <h3>Stainless Steel Tumbler</h3>
        <p class="preco">$ 31,00</p>
        <button type="button" class="btn-comprar" data-link="https://streamlabs.com/guarini_esports/merch/5609869">Buy</button>
      </article> 

      <article class="produto">
        <img src="./img-shop/copo.jpg" alt="Copo Guarin√≠" />
        <h3>Wine Cup</h3>
        <p class="preco">$ 26,00</p>
        <button type="button" class="btn-comprar" data-link="https://streamlabs.com/guarini_esports/merch/5609865">Buy</button>
      </article> 

      <article class="produto">
        <img src="./img-shop/apple-arte.jpg" alt="Capa Snap para iPhone Guarin√≠" />
        <h3>Snap Case for iPhone</h3>
        <p class="preco">$ 22,00</p>
        <button type="button" class="btn-comprar" data-link="https://streamlabs.com/guarini_esports/merch/5609863">Buy</button>
      </article> 

      <article class="produto">
        <img src="./img-shop/samgung-arte.jpg" alt="Capa Snap para Samsung Guarin√≠" />
        <h3>Snap Case for Samsung</h3>
        <p class="preco">$ 22,00</p>
         <button type="button" class="btn-comprar" data-link="https://streamlabs.com/guarini_esports/merch/5571581">Buy</button>
      </article> 

      <article class="produto">
        <img src="./img-shop/apple-transparente.jpg" alt="Capa transparente para iPhone Guarin√≠" />
        <h3>Clear Case for iPhone</h3>
        <p class="preco">$ 18,00</p>
        <button type="button" class="btn-comprar" data-link="https://streamlabs.com/guarini_esports/merch/5571559">Buy</button>
      </article>

      <article class="produto">
        <img src="./img-shop/samsung-transparente.jpg" alt="Capa transparente para Samsung Guarin√≠" />
        <h3>Clear Case for Samsung</h3>
        <p class="preco">$ 17,00</p>
        <button type="button" class="btn-comprar" data-link="https://streamlabs.com/guarini_esports/merch/5571557">Buy</button>
      </article> 

      <article class="produto">
        <img src="./img-shop/stick.jpg" alt="Adesivos hologr√°ficos Kiss-Cut Guarin√≠" />
        <h3>Holographic Kiss-Cut Stickers</h3>
        <p class="preco">$ 11,00</p>
        <button type="button" class="btn-comprar" data-link="https://streamlabs.com/guarini_esports/merch/5571571">Buy</button>
      </article>

    </section>

    <p style="text-align:center; margin-top: 2rem;">
      <a href="../index.html" class="btn-comprar">Back to Home</a>
    </p>
  </main>

  <footer>
  <div class="footer-content">
    <!-- Bot√µes de a√ß√£o no footer -->
    <div class="footer-actions">
      <!-- Bot√£o de instalar app -->
      <button id="installBtn" class="btn-install">üì± Install App</button>
      
      <!-- Seletor de idioma customizado -->
      <div class="language-selector">
        <button class="language-btn" id="languageBtn">
          <span class="flag flag-us"></span>
          <span id="currentLang">English</span>
          <span>‚ñº</span>
        </button>
        <div class="language-dropdown" id="languageDropdown">
          <div class="language-option" data-lang="pt" data-flag="flag-br" data-name="Portugu√™s">
            <span class="flag flag-br"></span>
            <span>Portugu√™s</span>
          </div>
          <div class="language-option" data-lang="en" data-flag="flag-us" data-name="English">
            <span class="flag flag-us"></span>
            <span>English</span>
          </div>
          <div class="language-option" data-lang="ja" data-flag="flag-jp" data-name="Êó•Êú¨Ë™û">
            <span class="flag flag-jp"></span>
            <span>Êó•Êú¨Ë™û</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Informa√ß√µes do footer -->
    <div class="footer-info">
        <p>&copy; ¬© 2019 Guarin√≠ E-sport. All rights reserved.</p>
        <p><a href="https://linktr.ee/guariniesports" target="_blank">Follow us on social media!</a></p>
        <p>Created by: Lobo & Shad</p>
    </div>
  </div>
</footer>

<!-- Firebase e Autentica√ß√£o -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-app.js";
    import { 
      getAuth, 
      onAuthStateChanged, 
      signOut 
    } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-auth.js";
    import { 
      getFirestore, 
      doc, 
      getDoc,
      collection, 
      query, 
      where, 
      getDocs 
    } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyC9LLCXrQTHBagQxaChBazSfS5E4gUPIoI",
      authDomain: "site-grn.firebaseapp.com",
      projectId: "site-grn",
      storageBucket: "site-grn.firebasestorage.app",
      messagingSenderId: "27613322806",
      appId: "1:27613322806:web:ad4dc08ce043f19d530297",
      measurementId: "G-84NHN394WF"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore();

    // ========================================
    // ELEMENTOS DO DOM - MENU USU√ÅRIO
    // ========================================
    const userMenuToggle = document.getElementById('userMenuToggle');
    const userDropdown = document.getElementById('userDropdown');
    const userDropdownHeader = document.getElementById('userDropdownHeader');
    const authLink = document.getElementById('authLink');
    const perfilLink = document.getElementById('perfilLink');

    // ========================================
    // ELEMENTOS DO DOM - BUSCA DE PERFIL
    // ========================================
    const profileSearchBtn = document.getElementById('profileSearchBtn');
    const profileSearchInput = document.getElementById('profileSearchInput');
    const profileSearchResults = document.getElementById('profileSearchResults');

    // ========================================
    // MENU DROPDOWN DO USU√ÅRIO
    // ========================================
    
    // Toggle do menu dropdown
    userMenuToggle.addEventListener('click', function(e) {
      e.stopPropagation();
      this.classList.toggle('active');
      userDropdown.classList.toggle('show');
    });

    // Fechar dropdown ao clicar fora
    document.addEventListener('click', function(e) {
      if (!userMenuToggle.contains(e.target) && !userDropdown.contains(e.target)) {
        userMenuToggle.classList.remove('active');
        userDropdown.classList.remove('show');
      }
    });

    // Fechar dropdown ao clicar em um link
    userDropdown.querySelectorAll('a').forEach(link => {
      link.addEventListener('click', function() {
        userMenuToggle.classList.remove('active');
        userDropdown.classList.remove('show');
      });
    });
    // ========================================
    // BUSCA DE PERFIL - COM BUSCA AUTOM√ÅTICA
    // ========================================

    // Fun√ß√£o para buscar perfil
    async function buscarPerfil() {
      const playerId = profileSearchInput.value.trim().toUpperCase();
      
      if (!playerId) {
        profileSearchResults.classList.remove('show');
        return;
      }
      
      if (playerId.length < 5 || playerId.length > 7) {
        // N√£o mostrar nada se n√£o tiver 7 caracteres
        profileSearchResults.classList.remove('show');
        return;
      }
      
      try {
        // Mostrar loading
        profileSearchResults.innerHTML = '<div class="profile-search-no-results">üîç Searching...</div>';
        profileSearchResults.classList.add('show');
        
        console.log('üîç Buscando Player ID:', playerId);
        
        // Buscar usu√°rio com esse Player ID
        const usuariosRef = collection(db, "usuarios");
        const q = query(usuariosRef, where("playerId", "==", playerId));
        
        console.log('üì° Query criada, executando busca...');
        
        const querySnapshot = await getDocs(q);
        
        console.log('üì¶ Resultado da busca:', {
          empty: querySnapshot.empty,
          size: querySnapshot.size
        });
        
        if (querySnapshot.empty) {
          console.log('‚ùå Nenhum usu√°rio encontrado com Player ID:', playerId);
          profileSearchResults.innerHTML = '<div class="profile-search-no-results">‚ùå Player not found</div>';
          return;
        }
        
        // Pegar o primeiro resultado (Player ID √© √∫nico)
        const userDoc = querySnapshot.docs[0];
        const userData = userDoc.data();
        const userId = userDoc.id;
        
        console.log('‚úÖ Usu√°rio encontrado:', {
          userId: userId,
          playerId: userData.playerId,
          displayName: userData.displayName,
          email: userData.email
        });
        
        // Mostrar resultado encontrado
        profileSearchResults.innerHTML = `
          <div class="profile-search-result-item" style="background: rgba(255, 173, 0, 0.1); cursor: default;">
            <div style="flex: 1;">
              <div style="color: #ffad00; font-weight: bold; margin-bottom: 5px;">
                ‚úÖ Player found!
              </div>
              <div style="color: #fff; font-size: 13px;">
                ${userData.displayName || 'Anonymous'}
              </div>
              <div style="color: #aaa; font-size: 11px; margin-top: 3px;">
                ID: ${userData.playerId}
              </div>
            </div>
          </div>
          <div style="margin-top: 10px; text-align: center;">
            <button 
              onclick="window.location.href='./perfil/perfil-view.html?uid=${userId}'" 
              style="background: linear-gradient(45deg, #ff7500, #ffad00); border: none; padding: 10px 20px; border-radius: 8px; color: #000; font-weight: bold; cursor: pointer; transition: all 0.3s ease;"
              onmouseover="this.style.transform='scale(1.05)'; this.style.boxShadow='0 5px 15px rgba(255, 173, 0, 0.5)'"
              onmouseout="this.style.transform='scale(1)'; this.style.boxShadow='none'"
            >
              üë§ View Profile
            </button>
          </div>
        `;
        
      } catch (error) {
        console.error('‚ùå Erro ao buscar perfil:', error);
        console.error('Detalhes do erro:', {
          message: error.message,
          code: error.code,
          stack: error.stack
        });
        
        profileSearchResults.innerHTML = `
          <div class="profile-search-no-results" style="color: #ff6b6b;">
            ‚ùå Search error<br>
            <small style="font-size: 11px; color: #aaa; margin-top: 5px; display: block;">
              ${error.message}
            </small>
          </div>
        `;
      }
    }

    // Toggle da barra de busca
    profileSearchBtn.addEventListener('click', (e) => {
      e.stopPropagation();
      console.log('üñ±Ô∏è Bot√£o de busca clicado');
      profileSearchInput.classList.toggle('active');
      
      if (profileSearchInput.classList.contains('active')) {
        console.log('‚úÖ Input ativado');
        profileSearchInput.focus();
      } else {
        console.log('‚ùå Input desativado');
        profileSearchInput.value = '';
        profileSearchResults.classList.remove('show');
      }
    });

    // Buscar ao pressionar Enter (mantido para compatibilidade)
    profileSearchInput.addEventListener('keypress', async (e) => {
      if (e.key === 'Enter') {
        console.log('‚å®Ô∏è Enter pressionado');
        await buscarPerfil();
      }
    });

    // Valida√ß√£o do input e BUSCA AUTOM√ÅTICA ao digitar 7 caracteres
    profileSearchInput.addEventListener('input', async (e) => {
      // Valida√ß√£o: apenas alfanum√©rico, m√°ximo 7 caracteres
      e.target.value = e.target.value.toUpperCase().replace(/[^A-Z0-9]/g, '');
      if (e.target.value.length > 7) {
        e.target.value = e.target.value.slice(0, 7);
      }
      
      // üî• BUSCA AUTOM√ÅTICA quando atingir 7 caracteres
      if (e.target.value.length >= 5 && e.target.value.length <= 7) {
        console.log('üéØ 7 caracteres digitados - buscando automaticamente...');
        await buscarPerfil();
      } else {
        // Se tiver menos de 7 caracteres, esconder resultados
        profileSearchResults.classList.remove('show');
      }
    });

    // Fechar ao clicar fora
    document.addEventListener('click', (e) => {
      if (!e.target.closest('.profile-search-container')) {
        profileSearchInput.classList.remove('active');
        profileSearchResults.classList.remove('show');
      }
    });

    // ========================================
    // AUTENTICA√á√ÉO DO USU√ÅRIO
    // ========================================
    
    // Fun√ß√£o para atualizar a interface com base no estado do usu√°rio
    async function updateUI(user) {
      if (user) {
        try {
          // Buscar dados do Firestore
          const userDocRef = doc(db, "usuarios", user.uid);
          const userDocSnap = await getDoc(userDocRef);
          
          let displayName = user.displayName || user.email.split('@')[0];
          let avatarPath = './estatisticas-shad/images/backgrounds/pikachu-left-bg.png';
          
          // Se existe documento no Firestore, usar os dados de l√°
          if (userDocSnap.exists()) {
            const userData = userDocSnap.data();
            if (userData.displayName) {
              displayName = userData.displayName;
            }
            if (userData.avatar) {
              avatarPath = userData.avatar;
            }
          }
          
          // Atualizar interface
          userDropdownHeader.innerHTML = `
            <img src="${avatarPath}" alt="Avatar" class="dropdown-avatar">
            <span>Ol√°, ${displayName}!</span>
          `;
          authLink.textContent = 'Logout';
          authLink.onclick = function(e) {
            e.preventDefault();
            handleLogout();
          };
          perfilLink.style.display = 'block';
          
          console.log('‚úÖ Usu√°rio logado:', user.email);
          
        } catch (error) {
          console.error('‚ùå Erro ao carregar dados do usu√°rio:', error);
          // Fallback em caso de erro
          userDropdownHeader.innerHTML = `
            <img src="./estatisticas-shad/images/backgrounds/pikachu-left-bg.png" alt="Avatar" class="dropdown-avatar">
            <span>Ol√°, ${user.email.split('@')[0]}!</span>
          `;
          authLink.textContent = 'Logout';
          authLink.onclick = function(e) {
            e.preventDefault();
            handleLogout();
          };
          perfilLink.style.display = 'block';
        }
      } else {
        // Usu√°rio n√£o est√° logado
        userDropdownHeader.innerHTML = '<span>Ol√°, visitante!</span>';
        authLink.textContent = 'Login';
        authLink.onclick = function(e) {
          e.preventDefault();
          handleLogin();
        };
        perfilLink.style.display = 'none';
        
        console.log('Usu√°rio n√£o logado');
      }
    }

    // Fun√ß√£o para fazer login
    function handleLogin() {
      window.location.href = '/login/login.html';
    }

    // Fun√ß√£o para fazer logout
    async function handleLogout() {
      const confirmar = confirm('Deseja realmente fazer logout?');
      if (confirmar) {
        try {
          // üî• LIMPAR DADOS DO LOCALSTORAGE
          localStorage.removeItem('userDisplayName');
          localStorage.removeItem('userAvatar');
          
          await signOut(auth);
          alert('Logout realizado com sucesso!');
          // A interface ser√° atualizada automaticamente pelo onAuthStateChanged
        } catch (error) {
          console.error('Erro no logout:', error);
          alert('Erro ao fazer logout. Tente novamente.');
        }
      }
    }

    // Monitorar mudan√ßas no estado de autentica√ß√£o
    onAuthStateChanged(auth, (user) => {
      updateUI(user);
    });
  </script>

  <script>
    // Redirecionar ao clicar nos bot√µes de compra
    const botoesComprar = document.querySelectorAll('.btn-comprar[data-link]');
    botoesComprar.forEach(botao => {
      botao.addEventListener('click', () => {
        window.open(botao.getAttribute('data-link'), '_blank');
      });
    });
  </script>
  <script>
  // PWA - Bot√£o de instala√ß√£o
  let deferredPrompt;
  window.addEventListener('beforeinstallprompt', (e) => {
    e.preventDefault();
    deferredPrompt = e;
    document.getElementById('installBtn').style.display = 'block';
  });

  document.getElementById('installBtn').addEventListener('click', async () => {
    if (!deferredPrompt) return;
    deferredPrompt.prompt();
    const { outcome } = await deferredPrompt.userChoice;
    deferredPrompt = null;
    document.getElementById('installBtn').style.display = 'none';
    console.log('Usu√°rio respondeu:', outcome);
  });

  // Seletor de idioma customizado
  const languageBtn = document.getElementById('languageBtn');
  const languageDropdown = document.getElementById('languageDropdown');
  const currentLang = document.getElementById('currentLang');
  const languageOptions = document.querySelectorAll('.language-option');

  languageBtn.addEventListener('click', function(e) {
    e.stopPropagation();
    languageDropdown.classList.toggle('show');
  });

  document.addEventListener('click', function(e) {
    if (!languageBtn.contains(e.target)) {
      languageDropdown.classList.remove('show');
    }
  });

  languageOptions.forEach(option => {
    option.addEventListener('click', function() {
      const lang = this.dataset.lang;
      const flag = this.dataset.flag;
      const name = this.dataset.name;
      
      const flagElement = languageBtn.querySelector('.flag');
      flagElement.className = `flag ${flag}`;
      currentLang.textContent = name;
      languageDropdown.classList.remove('show');
      
      const translateElement = document.querySelector('.goog-te-combo');
      if (translateElement) {
        translateElement.value = lang;
        translateElement.dispatchEvent(new Event('change'));
      } else {
        setTimeout(() => {
          const translateElement = document.querySelector('.goog-te-combo');
          if (translateElement) {
            translateElement.value = lang;
            translateElement.dispatchEvent(new Event('change'));
          }
        }, 1000);
      }
    });
  });
</script>

</body>
</html>